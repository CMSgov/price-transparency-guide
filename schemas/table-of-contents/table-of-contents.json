{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "$id": "https://github.com/CMSgov/price-transparency-guide/blob/master/schemas/table-of-contents/table-of-contents.json",
  "definitions": {
    "file_location": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1
        },
        "location": {
          "type": "string",
          "format": "uri",
          "pattern": "^https://"
        }
      },
      "required": [
        "description",
        "location"
      ]
    },
    "reporting_structure": {
      "type": "object",
      "properties": {
        "reporting_plans": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/reporting_plans"
          },
          "uniqueItems": true,
          "default": [],
          "minItems": 1
        },
        "in_network_files": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/file_location"
          },
          "uniqueItems": true,
          "default": [],
          "minItems": 1
        },
        "allowed_amount_file": {
          "$ref": "#/definitions/file_location"
        }
      },
      "anyOf": [
        {
          "required": [
            "in_network_files"
          ]
        },
        {
          "required": [
            "allowed_amount_file"
          ]
        }
      ],
      "required": [
        "reporting_plans"
      ]
    },
    "reporting_plans": {
      "type": "object",
      "properties": {
        "plan_name": {
          "type": "string",
          "minLength": 1
        },
        "issuer_name": {
          "type": "string",
          "minLength": 1
        },
        "plan_id_type": {
          "type": "string",
           "enum": ["ein","hios"]
        },
        "plan_id": {
          "type": "string",
          "minLength": 1
        },
        "plan_sponsor_name": {
          "type": "string",
          "minLength": 1
        },
        "plan_market_type": {
          "enum": [
            "group",
            "individual"
          ]
        }
      },
      "required": [
        "plan_name",
        "plan_id_type",
        "plan_id",
        "plan_market_type",
        "issuer_name"
      ],
      "oneOf": [
        {
          "properties": {
            "plan_id_type": { "enum": ["ein"] }
          },
          "required": ["plan_id_type", "plan_id", "plan_sponsor_name"]
        },
        {
          "properties": {
            "plan_id_type": { "enum": ["hios"] }
          },
          "required": ["plan_id_type", "plan_id"]
        }
      ]
    }
  },
  "type": "object",
  "properties": {
    "reporting_entity_name": {
      "type": "string",
      "minLength": 1
    },
    "reporting_entity_type": {
      "type": "string",
      "minLength": 1
    },
    "version": {
      "type": "string",
      "minLength": 1
    },
    "last_updated_on": {
      "type": "string",
      "format": "date",
      "description": "This is a date format of YYYY-MM-DD",
      "minLength": 10,
      "maxLength": 10
    },
    "reporting_structure": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/reporting_structure"
      },
      "uniqueItems": true,
      "default": [],
      "minItems": 1
    }
  },
  "required": [
    "reporting_entity_name",
    "reporting_entity_type",
    "reporting_structure",
    "last_updated_on",
    "version"
  ]
}
