{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/CMSgov/price-transparency-guide/blob/master/schemas/table-of-contents/table-of-contents.json",
  "definitions": {
    "file_location": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1
        },
        "location": {
          "type": "string",
          "format": "uri",
          "pattern": "^https://"
        }
      },
      "required": ["description", "location"]
    },
    "reporting_structure": {
      "type": "object",
      "properties": {
        "reporting_plans": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/reporting_plans"
          },
          "uniqueItems": true,
          "default": [],
          "minItems": 1
        },
        "in_network_files": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/file_location"
          },
          "uniqueItems": true,
          "default": [],
          "minItems": 1
        },
        "allowed_amount_file": {
          "$ref": "#/definitions/file_location"
        }
      },
      "anyOf": [
        { "required": ["in_network_files"] },
        { "required": ["allowed_amount_file"] }
      ],
      "required": ["reporting_plans"]
    },
    "reporting_plans": {
      "type": "object",
      "properties": {
        "plan_name": {
          "type": "string",
          "minLength": 1
        },
        "plan_sponsor_name": {
          "type": "string",
          "minLength": 1
        },
        "plan_id_type": {
          "enum": ["ein", "hios"]
        },
        "plan_id": {
          "type": "string",
          "minLength": 1
        },
        "plan_market_type": {
          "enum": ["group", "individual"]
        },
        "product_network_type": {
          "enum": [
            "HMO",
            "PPO",
            "EPO",
            "POS",
            "HDHP",
            "Catastrophic",
            "Bronze",
            "Silver",
            "Gold",
            "Platinum",
            "FFS"
          ]
        }
      },

      "if": {
        "properties": {
          "plan_id_type": {
            "enum": ["ein"]
          }
        }
      },
      "then": {
        "required": ["plan_sponsor_name"]
      },
      "required": [
        "plan_name",
        "plan_id_type",
        "plan_id",
        "plan_market_type",
        "product_network_type"
      ]
    }
  },
  "type": "object",
  "properties": {
    "reporting_entity_name": {
      "type": "string",
      "minLength": 1
    },
    "reporting_entity_type": {
      "type": "string",
      "minLength": 1
    },
    "version": {
      "type": "string",
      "minLength": 1
    },
    "reporting_structure": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/reporting_structure"
      },
      "uniqueItems": true,
      "default": [],
      "minItems": 1
    }
  },
  "required": [
    "reporting_entity_name",
    "reporting_entity_type",
    "reporting_structure",
    "version"
  ]
}
